<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é­”æ³•å­¸é™¢è©¦ç…‰ // MAGIC TRIAL</title>
    <style>
        /* --- é­”æ³•ä¸–ç•Œè§€æ°›åœ --- */
        body {
            background-color: #1a0b2e;
            color: #ffd700;
            font-family: 'Times New Roman', serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            background-image: radial-gradient(circle at 50% 50%, #2d1b4e 0%, #1a0b2e 100%);
        }

        .console-container {
            width: 800px;
            height: 580px;
            background: rgba(30, 15, 50, 0.95);
            border: 5px double #ffd700;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.2), inset 0 0 60px rgba(0, 0, 0, 0.8);
            position: relative;
            padding: 30px;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
        }

        .header-bar {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid #b8860b;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.1em;
            color: #e6e6fa;
            letter-spacing: 1px;
        }

        .main-screen {
            flex-grow: 1;
            background: #11051b;
            border: 1px solid #4b0082;
            padding: 25px;
            overflow-y: auto;
            position: relative;
            color: #e0d0ff;
            font-size: 1.2em;
            line-height: 1.8;
            box-shadow: inset 0 0 20px #000;
        }

        /* --- è¼‰å…¥æ¢å‹•ç•« --- */
        .loader-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #1a0b2e;
            z-index: 999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
        }
        .progress-bar-bg {
            width: 70%;
            height: 15px;
            background: #2a1a40;
            border: 2px solid #ffd700;
            margin-top: 25px;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #9400d3, #ffd700);
            width: 0%;
            transition: width 0.1s linear;
            box-shadow: 0 0 15px #9400d3;
        }
        .warning-text {
            color: #ff6b6b;
            font-size: 0.9em;
            margin-top: 15px;
            font-style: italic;
            animation: glow 2s infinite alternate;
        }

        .control-panel {
            margin-top: 25px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        input {
            background: transparent;
            border: none;
            border-bottom: 3px solid #ffd700;
            color: #fff;
            font-size: 1.6em;
            text-align: center;
            width: 250px;
            font-family: 'Times New Roman', serif;
        }
        input:focus { outline: none; background: rgba(255, 215, 0, 0.1); }
        
        button {
            background: linear-gradient(to bottom, #ffd700, #b8860b);
            color: #2a0a3b;
            border: 1px solid #fff;
            padding: 12px 30px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            font-family: 'Times New Roman', serif;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transition: 0.3s;
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 0 20px #ffd700; }
        button:disabled { background: #333; color: #666; cursor: not-allowed; transform: none; box-shadow: none;}

        @keyframes glow { from {text-shadow: 0 0 5px #ff0000;} to {text-shadow: 0 0 20px #ff0000;} }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .result-card {
            border: 2px solid #ffd700;
            padding: 20px;
            margin-top: 20px;
            background: rgba(75, 0, 130, 0.3);
            color: #fff;
            position: relative;
        }
        .result-card::before {
            content: "âœ¦"; position: absolute; top: -15px; left: 48%; color: #ffd700; font-size: 20px;
        }
        
        .highlight { color: #ffd700; font-weight: bold; text-shadow: 0 0 5px #ffd700; }
        .error { color: #ff6b6b; font-style: italic; }
        .magic-text { color: #e6e6fa; font-style: italic; }
        
        /* é—œéµæ¨£å¼ï¼šéš±è—å…ƒç´  */
        .hidden { display: none !important; }

        /* é¸æ“‡é¡Œæ¨£å¼ */
        .choice-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        .choice-btn {
            background: rgba(75, 0, 130, 0.5);
            border: 2px solid #ffd700;
            color: #e6e6fa;
            padding: 20px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 8px;
            position: relative;
        }
        .choice-btn:hover {
            background: rgba(148, 0, 211, 0.7);
            box-shadow: 0 0 20px #ffd700;
            transform: scale(1.05);
        }

        /* æ‹–æ›³æ–¹å¡Šæ¨£å¼ */
        .drag-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .draggable {
            background: linear-gradient(135deg, #9400d3, #4b0082);
            color: #ffd700;
            padding: 15px 25px;
            border: 2px solid #ffd700;
            border-radius: 10px;
            cursor: move;
            font-size: 1.3em;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transition: all 0.2s;
        }
        .draggable:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px #ffd700;
        }
        .draggable.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        .drop-zone {
            min-width: 100px;
            min-height: 60px;
            border: 3px dashed #ffd700;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            padding: 10px;
            background: rgba(75, 0, 130, 0.3);
            vertical-align: middle;
        }
        .drop-zone.drag-over {
            background: rgba(255, 215, 0, 0.2);
            border-color: #fff;
        }
        .formula-display {
            font-size: 1.5em;
            text-align: center;
            margin: 20px 0;
            color: #e6e6fa;
        }

        /* ç²’å­å‹•ç•« */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ffd700;
            border-radius: 50%;
            pointer-events: none;
            animation: float-up 2s ease-out forwards;
        }
        @keyframes float-up {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(0); opacity: 0; }
        }

    </style>
</head>
<body>

<div class="console-container">
    <div id="loader" class="loader-container">
        <h2 style="color: #ffd700; font-size: 2em;">æ­£åœ¨é–‹å•Ÿé­”æ³•å‚³é€é–€...</h2>
        <div style="font-size: 1em; color: #b0c4de;">Establishing Mana Connection...</div>
        <div class="progress-bar-bg">
            <div id="progress" class="progress-bar-fill"></div>
        </div>
        <div id="loading-text" style="margin-top: 15px; color: #ffd700;">0% - å‡èšé­”åŠ›ä¸­</div>
        <div class="warning-text">âš ï¸ è­¦å‘Šï¼šæ­£åœ¨ç©¿è¶Šæ¬¡å…ƒï¼Œè«‹å‹¿åˆ·æ–°ç¶²é ï¼Œå¦å‰‡é­”åŠ›å°‡æ¶ˆæ•£</div>
    </div>

    <div class="header-bar">
        <span>Wizard: <span id="unit-id" style="color:#ffd700;">APPRENTICE</span></span>
        <span>Academy Status: <span id="game-status" style="color:#adff2f;">OPEN</span></span>
        <span>Magic Time: <span id="real-time">00:00</span></span>
    </div>

    <div id="screen" class="main-screen"></div>

    <div class="control-panel">
        <input type="text" id="user-input" placeholder="è© å”±å’’èª (è¼¸å…¥ç­”æ¡ˆ)" autocomplete="off">
        <button id="action-btn" onclick="handleAction()">æ–½æ³•</button>
    </div>
</div>

<script>
    const gameData = {
        player: "è¦‹ç¿’å·«å¸«",
        currentLevel: 0,
        state: "loading", 
        score: 0
    };

    const levels = [
        {
            title: "TRIAL 1: é­”è—¥å­¸çš„é…æ–¹ (å¤§æ•¸é‹ç®—)",
            type: "choice",
            story: "ã€é­”è—¥å­¸æ•™æˆã€‘<br>ã€Œå¦‚æœä½ æƒ³èª¿é…ã€å¹¸é‹è—¥æ°´ã€ï¼Œæ•¸å­—çµ•ä¸èƒ½å‡ºéŒ¯ã€‚æˆ‘å€‘è¦è·Ÿå¦–ç²¾è³¼è²·é¾çš„é±—ç‰‡ã€‚ã€<br><br>å¦–ç²¾é€ä¾†äº† <span class='highlight'>125</span> ç®±é±—ç‰‡ï¼Œæ¯ç®±è£¡é¢æœ‰ <span class='highlight'>240</span> ç‰‡ã€‚<br>è«‹å•æˆ‘å€‘ç¸½å…±æœ‰å¹¾ç‰‡é¾é±—ï¼Ÿ<br><br>ğŸ§ª è«‹é¸æ“‡æ­£ç¢ºçš„é­”è—¥é…æ–¹:",
            question_log: "125 x 240 = ?",
            formula_hint: "æç¤ºï¼šæŠŠ 240 æ‹†æˆ 8 x 30ï¼Œ125 x 8 æ˜¯å¤šå°‘å‘¢ï¼Ÿ",
            choices: ["28,000 ç‰‡", "30,000 ç‰‡", "32,500 ç‰‡", "35,000 ç‰‡"],
            answer: 30000,
            success_msg: "é…æ–¹æ­£ç¢ºï¼å¤§é‡œè£¡çš„è—¥æ°´è®Šæˆäº†ç¾éº—çš„é‡‘è‰²ã€‚",
            icon: "ğŸ§ª"
        },
        {
            title: "TRIAL 2: å­¸é™¢çš„ç¦®ç‰© (å…¬å› æ•¸)",
            type: "input",
            story: "ã€éœæ ¼è¯èŒ²äº¤èª¼å»³ã€‘<br>ä»Šå¤©æ˜¯è¬è–ç¯€ï¼Œæˆ‘å€‘è¦è£½ä½œã€å®Œå…¨å…¬å¹³ã€çš„é­”æ³•ç¦è¢‹åˆ†çµ¦å­¸å¼Ÿå¦¹ã€‚<br>æ¡Œä¸Šæœ‰ <span class='highlight'>48</span> æ ¹ç”˜è‰é­”æ–å’Œ <span class='highlight'>72</span> é¡†æŸè’‚å…¨å£å‘³è±†ã€‚<br>æ¯å€‹ç¦è¢‹è£¡çš„å…§å®¹ç‰©è¦å®Œå…¨ä¸€æ¨£ï¼Œä¸”ä¸èƒ½å‰©ä¸‹ã€‚<br><br>ğŸ è«‹å•ï¼šæˆ‘å€‘ã€æœ€å¤šã€å¯ä»¥åšå‡ºå¹¾å€‹ç¦è¢‹ï¼Ÿ",
            question_log: "æ±‚ (48, 72) çš„æœ€å¤§å…¬å› æ•¸",
            formula_hint: "æç¤ºï¼šä½¿ç”¨çŸ­é™¤æ³•æ‰¾å‡º G.C.D",
            answer: 24,
            success_msg: "åˆ†è£å®Œæˆï¼æ¯å€‹äººéƒ½æ‹¿åˆ°äº†å…¬å¹³çš„ç¦®ç‰©ã€‚",
            icon: "ğŸ"
        },
        {
            title: "TRIAL 3: é­”æ³•é™£çš„ç¹ªè£½ (åœ–å½¢å°ç¨±)",
            type: "choice",
            story: "ã€é˜²ç¦¦è¡“æ•™å®¤ã€‘<br>æœ‰å‚¬ç‹‚é­”é è¿‘äº†ï¼å¿«é»ç•«å‡ºé­”æ³•é™£ä¿è­·è‡ªå·±ï¼<br>æœ€å¼·çš„é˜²ç¦¦é­”æ³•é™£æ˜¯ã€æ­£å…­é‚Šå½¢ã€çš„é›ªèŠ±è­·ç›¾ã€‚<br><br>ç‚ºäº†è®“é­”æ³•ç©©å®šï¼Œä½ éœ€è¦çŸ¥é“å®ƒæœ‰å¹¾æ¢ã€å°ç¨±è»¸ã€ã€‚<br><br>ğŸ›¡ï¸ è«‹é¸æ“‡æ­£ç¢ºçš„å°ç¨±è»¸æ•¸é‡:",
            question_log: "æ­£å…­é‚Šå½¢çš„å°ç¨±è»¸æ•¸é‡ = ?",
            formula_hint: "æç¤ºï¼šæ­£ N é‚Šå½¢å°±æœ‰ N æ¢å°ç¨±è»¸...",
            choices: ["3 æ¢", "4 æ¢", "6 æ¢", "8 æ¢"],
            answer: 6,
            success_msg: "è­·ç›¾å±•é–‹ï¼éŠ€è‰²çš„å…‰èŠ’æ“‹ä½äº†é»‘æš—ç”Ÿç‰©ã€‚",
            icon: "ğŸ›¡ï¸"
        },
        {
            title: "FINAL TRIAL: å¯†å®¤çš„é€šé—œå¯†èª (é‹ç®—å¼æ‹–æ›³)",
            type: "drag",
            story: "ã€æ ¡é•·çš„å¯†å®¤ã€‘<br>æ­å–œä½ ä¾†åˆ°æœ€å¾Œä¸€é—œã€‚æ ¡é•·å®¤çš„çŸ³åƒé¬¼éœ€è¦é€šé—œå¯†èªã€‚<br>å¯†èªæ˜¯ä¸€å€‹äºŒä½æ•¸çš„æ•¸å­—ã€‚<br>å®ƒæ˜¯ 5 çš„å€æ•¸ï¼Œä¹Ÿæ˜¯ 3 çš„å€æ•¸ã€‚<br>è€Œä¸”å®ƒä»‹æ–¼ 50 åˆ° 70 ä¹‹é–“ã€‚<br><br>ğŸ”® è«‹æ‹–æ›³æ•¸å­—å®Œæˆé‹ç®—å¼:",
            question_log: "5å’Œ3çš„å…¬å€æ•¸ï¼Œ50 < X < 70",
            formula_hint: "æç¤ºï¼šæ‰¾å‡º 15 çš„å€æ•¸...",
            dragElements: ["15", "Ã—", "2", "3", "4", "5"],
            correctFormula: ["15", "Ã—", "4"],
            answer: 60,
            success_msg: "çŸ³åƒé¬¼ç§»é–‹äº†ã€‚æ­¡è¿é€²å…¥å¤§é­”æ³•å¸«çš„è¡Œåˆ—ã€‚",
            icon: "ğŸ”®"
        }
    ];

    window.onload = function() {
        updateTime();
        setInterval(updateTime, 1000);
        startLoader(); 
    };

    function startLoader() {
        const progress = document.getElementById('progress');
        const text = document.getElementById('loading-text');
        const loader = document.getElementById('loader');
        let width = 0;
        
        let speed = 20; // æ¸¬è©¦æ¨¡å¼ï¼šé€Ÿåº¦è¨­ç‚º 20 (è‹¥è¦æ­£å¼ä¸Šèª²é˜²ä½œå¼Šï¼Œè«‹æ”¹æˆ 600)

        window.skipLoad = () => { width = 100; };

        let interval = setInterval(() => {
            if (width >= 100) {
                clearInterval(interval);
                loader.classList.add('hidden'); // é—œéµï¼šåŠ ä¸Š hidden class éš±è—è¼‰å…¥ç•«é¢
                initGame();
            } else {
                width++;
                progress.style.width = width + '%';
                text.innerText = width + '% - æ³¨å…¥é­”åŠ›ä¸­...';
            }
        }, speed);
    }

    function initGame() {
        gameData.state = "intro";
        document.getElementById('screen').innerHTML = '<span class="magic-text">æ­¡è¿ä¾†åˆ°é­”æ³•å­¸é™¢ï¼Œå¹´è¼•çš„å­¸å¾’ã€‚<br>é€™è£¡çš„é­”æ³•æ˜¯å»ºç«‹åœ¨ã€æ•¸å­¸ã€èˆ‡ã€é‚è¼¯ã€ä¹‹ä¸Šçš„ã€‚<br>å‘Šè¨´æˆ‘ä½ çš„åå­—ï¼Œæˆ‘å€‘å°‡é–‹å§‹æ¸¬é©—ã€‚<br><br>[è«‹è¼¸å…¥ä½ çš„å·«å¸«åè™Ÿ]</span>';
    }

    function handleAction() {
        const input = document.getElementById('user-input');
        const val = input.value.trim();

        if (gameData.state === "intro") {
            if (val === "") return;
            gameData.player = val;
            document.getElementById('unit-id').innerText = val.toUpperCase();
            input.value = "";
            startLevel(0);
        } else if (gameData.state === "question") {
            checkAnswer(val);
        } else if (gameData.state === "result") {
            nextLevel();
        }
    }

    function startLevel(idx) {
        gameData.currentLevel = idx;
        const level = levels[idx];
        const screen = document.getElementById('screen');
        const btn = document.getElementById('action-btn');
        const input = document.getElementById('user-input');

        gameData.state = "question";
        
        let interactionHTML = '';
        
        if (level.type === "choice") {
            interactionHTML = `
                <div class="choice-container">
                    ${level.choices.map((choice, i) => `
                        <div class="choice-btn" onclick="selectChoice(${i})">
                            ${level.icon} ${choice}
                        </div>
                    `).join('')}
                </div>
            `;
            input.style.display = 'none';
            btn.style.display = 'none';
        } else if (level.type === "drag") {
            interactionHTML = `
                <div class="formula-display">
                    è«‹å°‡æ•¸å­—å’Œç¬¦è™Ÿæ‹–æ›³åˆ°ä¸‹æ–¹ç©ºæ ¼:<br><br>
                    <div id="drop-area" style="display: inline-block;">
                        <span class="drop-zone" data-index="0"></span>
                        <span class="drop-zone" data-index="1"></span>
                        <span class="drop-zone" data-index="2"></span>
                    </div>
                    <div style="margin-top: 20px;">= <span id="result-display" style="color: #ffd700; font-size: 1.8em;">?</span></div>
                </div>
                <div class="drag-container" id="drag-source">
                    ${level.dragElements.map((el, i) => `
                        <div class="draggable" draggable="true" data-value="${el}" data-id="${i}">
                            ${el}
                        </div>
                    `).join('')}
                </div>
            `;
            input.style.display = 'none';
            btn.style.display = 'none';
        } else {
            interactionHTML = '';
            input.style.display = 'inline-block';
            btn.style.display = 'inline-block';
        }
        
        screen.innerHTML = `
            <h2 style="color:#ffd700; border-bottom:1px solid #4b0082;">âœ¦ ${level.title} âœ¦</h2>
            <p style="font-size:1.1em;">${level.story}</p>
            <div style="margin-top:30px; color:#b0c4de; font-size:0.9em; border:1px dashed #4b0082; padding:10px;">${level.formula_hint}</div>
            ${interactionHTML}
        `;
        
        if (level.type === "drag") {
            setTimeout(() => initDragAndDrop(), 100);
        }
        
        if (level.type === "input") {
            input.value = "";
            input.placeholder = "è§£è®€æ˜Ÿè±¡ä¸­...";
            input.disabled = true;
            btn.disabled = true;
            btn.innerText = "é­”åŠ›å†·å»ä¸­...";

            let cooldown = 10; // æ¸¬è©¦æ¨¡å¼ï¼šå†·å» 10ç§’
            let timer = setInterval(() => {
                cooldown--;
                btn.innerText = `é­”åŠ›å‡èš (${cooldown}s)`;
                if (cooldown <= 0) {
                    clearInterval(timer);
                    input.disabled = false;
                    btn.disabled = false;
                    input.placeholder = "è¼¸å…¥å’’èª (ç­”æ¡ˆ)";
                    btn.innerText = "æ–½æ”¾é­”æ³•";
                    input.focus();
                }
            }, 1000);
        }
    }

    function checkAnswer(val) {
        const level = levels[gameData.currentLevel];
        const screen = document.getElementById('screen');
        
        if (parseInt(val) === level.answer) {
            playSound('success');
            showResult(level);
        } else {
            playSound('error');
            screen.innerHTML += `<div class="error">>> å’’èªåå™¬ï¼ç­”æ¡ˆéŒ¯èª¤ï¼Œè«‹é‡æ–°è¨ˆç®—...</div>`;
            screen.scrollTop = screen.scrollHeight;
            shakeScreen();
        }
    }

    function selectChoice(index) {
        const level = levels[gameData.currentLevel];
        // æå–æ•¸å­— (ä¾‹å¦‚ "28,000 ç‰‡" -> 28000)
        const userAnswer = parseInt(level.choices[index].replace(/[^\d]/g, ''));
        
        if (userAnswer === level.answer) {
            playSound('success');
            createParticles();
            showResult(level);
        } else {
            playSound('error');
            shakeScreen();
            const screen = document.getElementById('screen');
            screen.innerHTML += `<div class="error" style="margin-top:20px;">âœ— å’’èªåå™¬ï¼ç­”æ¡ˆéŒ¯èª¤ï¼Œè«‹é‡æ–°é¸æ“‡...</div>`;
            screen.scrollTop = screen.scrollHeight;
        }
    }

    let draggedElement = null;

    function initDragAndDrop() {
        const draggables = document.querySelectorAll('.draggable');
        const dropZones = document.querySelectorAll('.drop-zone');

        draggables.forEach(drag => {
            drag.addEventListener('dragstart', (e) => {
                draggedElement = drag;
                drag.classList.add('dragging');
            });

            drag.addEventListener('dragend', () => {
                drag.classList.remove('dragging');
            });
        });

        dropZones.forEach(zone => {
            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
                zone.classList.add('drag-over');
            });

            zone.addEventListener('dragleave', () => {
                zone.classList.remove('drag-over');
            });

            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('drag-over');
                
                if (draggedElement && zone.children.length === 0) {
                    const clone = draggedElement.cloneNode(true);
                    clone.draggable = false;
                    clone.style.cursor = 'pointer';
                    clone.onclick = () => {
                        clone.remove();
                        updateDragFormula();
                    };
                    zone.appendChild(clone);
                    updateDragFormula();
                }
            });
        });
    }

    function updateDragFormula() {
        const dropZones = document.querySelectorAll('.drop-zone');
        let dropSequence = [];
        
        dropZones.forEach(zone => {
            if (zone.children.length > 0) {
                dropSequence.push(zone.children[0].dataset.value);
            } else {
                dropSequence.push(null);
            }
        });

        if (dropSequence.filter(x => x !== null).length === 3) {
            try {
                const formula = dropSequence.join(' ');
                // å°‡ Ã— æ›¿æ›ç‚º * é€²è¡Œè¨ˆç®—
                const result = eval(formula.replace('Ã—', '*'));
                document.getElementById('result-display').innerText = result;
                
                const level = levels[gameData.currentLevel];
                if (JSON.stringify(dropSequence) === JSON.stringify(level.correctFormula)) {
                    setTimeout(() => {
                        playSound('success');
                        createParticles();
                        showResult(level);
                    }, 500);
                }
            } catch (e) {
                document.getElementById('result-display').innerText = '?';
            }
        } else {
            document.getElementById('result-display').innerText = '?';
        }
    }

    function showResult(level) {
        gameData.state = "result";
        const screen = document.getElementById('screen');
        const btn = document.getElementById('action-btn');
        const input = document.getElementById('user-input');

        screen.innerHTML = `
            <div class="result-card">
                <h3 style="margin:0; color:#ffd700; text-align:center;">â˜… TRIAL COMPLETE â˜…</h3>
                <p style="text-align:center;">è©¦ç…‰é€šéï¼è«‹ç´€éŒ„ä½ çš„é­”æ³•ç­†è¨˜ã€‚</p>
                <hr style="border:1px solid #ffd700;">
                <p><strong>è©¦ç…‰å…§å®¹ï¼š</strong> ${level.question_log}</p>
                <p><strong>é­”æ³•åŸç†ï¼š</strong> ${level.formula_hint}</p>
                <p><strong>æ­£ç¢ºå’’èªï¼š</strong> <span class="highlight" style="font-size:1.5em;">${level.answer}</span></p>
                <p><strong>çµæœï¼š</strong> ${level.success_msg}</p>
            </div>
            <div id="upload-status" style="margin-top:20px; color:#ffd700; text-align:center;">æ­£åœ¨éŠ˜åˆ»é­”æ³•ç´‹ç« ...</div>
        `;

        input.value = "";
        input.style.display = 'inline-block';
        btn.style.display = 'inline-block';
        input.placeholder = "ç´€éŒ„ä¸­...";
        input.disabled = true;
        btn.disabled = true;

        let waitTime = 10; // æ¸¬è©¦æ¨¡å¼ï¼šç¸®çŸ­ç­‰å¾…æ™‚é–“ç‚º 10ç§’
        let timer = setInterval(() => {
            waitTime--;
            btn.innerText = `éŠ˜åˆ»ä¸­ (${waitTime}s)`;
            if (waitTime <= 0) {
                clearInterval(timer);
                btn.disabled = false;
                btn.innerText = "å‰å¾€ä¸‹ä¸€å±¤è©¦ç…‰";
                document.getElementById('upload-status').innerText = ">> ç´‹ç« éŠ˜åˆ»å®Œæˆã€‚è«‹æº–å‚™ä¸‹ä¸€é—œã€‚";
            }
        }, 1000);
    }

    function nextLevel() {
        if (gameData.currentLevel + 1 < levels.length) {
            startLevel(gameData.currentLevel + 1);
        } else {
            document.getElementById('screen').innerHTML = `
                <h1 style="text-align:center; color:#ffd700; margin-top:30px;">GRAND WIZARD</h1>
                <p style="text-align:center; font-size:1.2em;">æ­å–œä½ ï¼Œ${gameData.player}ã€‚</p>
                <p style="text-align:center;">ä½ å·²é€šéæ‰€æœ‰è©¦ç…‰ï¼Œè­‰æ˜äº†ä½ çš„æ™ºæ…§ã€‚</p>
                <p style="text-align:center;">ç¾åœ¨ï¼Œè«‹å°‡ä½ çš„å››å¼µã€Œè©¦ç…‰é€šéè­‰æ˜ã€(æˆªåœ–)ï¼Œ<br>è²¼åˆ°ä½ çš„é­”æ³•è­‰æ›¸ä¸Šå§ï¼</p>
            `;
            document.getElementById('action-btn').style.display = 'none';
            document.getElementById('user-input').style.display = 'none';
        }
    }

    function createParticles() {
        const container = document.querySelector('.console-container');
        for (let i = 0; i < 30; i++) {
            setTimeout(() => {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.background = ['#ffd700', '#9400d3', '#4b0082'][Math.floor(Math.random() * 3)];
                container.appendChild(particle);
                setTimeout(() => particle.remove(), 2000);
            }, i * 30);
        }
    }

    function shakeScreen() {
        const container = document.querySelector('.console-container');
        container.style.animation = 'shake 0.5s';
        setTimeout(() => {
            container.style.animation = '';
        }, 500);
    }

    // å»ºç«‹éŸ³æ•ˆç³»çµ±
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        // å¦‚æœç€è¦½å™¨é˜»æ“‹è‡ªå‹•æ’­æ”¾ï¼Œé€™è£¡å¯èƒ½æœƒå ±éŒ¯ï¼Œæ‰€ä»¥åŠ å€‹ try-catch
        try {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'success') {
                // æˆåŠŸéŸ³æ•ˆï¼šDo-Mi-Sol
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.4);
            } else if (type === 'error') {
                // å¤±æ•—éŸ³æ•ˆ
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(150, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            }
        } catch(e) {
            console.log("Audio play failed (user interaction needed first)");
        }
    }

    function updateTime() {
        const now = new Date();
        const timeString = now.toTimeString().substring(0, 5);
        document.getElementById('real-time').innerText = timeString;
    }

</script>
</body>
</html>
